#!/bin/sh
# Pre-push hook: Run tests before pushing
# Install with: cp scripts/hooks/pre-push .git/hooks/pre-push && chmod +x .git/hooks/pre-push

# Consume stdin (git passes refs here) to prevent it leaking to subprocesses
cat > /dev/null

echo "Running tests before push..."

# Run tests, capture output
TEST_OUTPUT=$(bun test 2>&1)
TEST_EXIT_CODE=$?

if [ $TEST_EXIT_CODE -ne 0 ]; then
    echo ""
    echo "Tests failed! Push aborted."
    echo ""
    echo "$TEST_OUTPUT" | tail -30
    echo ""
    echo "Run 'bun test' to see full output."
    exit 1
fi

# Show summary only
echo "$TEST_OUTPUT" | tail -3
exit 0
